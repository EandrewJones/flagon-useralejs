/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * @preserved
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).userale={})}(this,(function(e){"use strict";var n="2.1.1",t=null;function o(e,n){Object.keys(n).forEach((function(t){if("userFromParams"===t){var o=(r=n[t],i=new RegExp("[?&]"+r+"(=([^&#]*)|&|#|$)"),(a=window.location.href.match(i))&&a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):null);o&&(e.userId=o)}var r,i,a;e[t]=n[t]}))}var r=function(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var o=Array(e),r=0;for(n=0;n<t;n++)for(var i=arguments[n],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o},i=function(e,n,t){this.name=e,this.version=n,this.os=t,this.type="browser"},a=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},s=function(e,n,t,o){this.name=e,this.version=n,this.os=t,this.bot=o,this.type="bot-device"},u=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},l=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},c=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,d=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],f=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function m(e){var n=function(e){return""!==e&&d.reduce((function(n,t){var o=t[0],r=t[1];if(n)return n;var i=r.exec(e);return!!i&&[o,i]}),!1)}(e);if(!n)return null;var t=n[0],o=n[1];if("searchbot"===t)return new u;var a=o[1]&&o[1].split(/[._]/).slice(0,3);a?a.length<3&&(a=r(a,function(e){for(var n=[],t=0;t<e;t++)n.push("0");return n}(3-a.length))):a=[];var l=a.join("."),m=function(e){for(var n=0,t=f.length;n<t;n++){var o=f[n],r=o[0];if(o[1].exec(e))return r}return null}(e),p=c.exec(e);return p&&p[1]?new s(t,l,m,p[1]):new i(t,l,m)}var p,h,w,g,v,y,b,S,O,T=p?m(p):"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new l:"undefined"!=typeof navigator?m(navigator.userAgent):"undefined"!=typeof process&&process.version?new a(process.version.slice(1)):null,W=null,k=null;function N(e,n){if(!w.on)return!1;var t=null;n&&(t=n(e));var o,r=(o=e.timeStamp&&e.timeStamp>0?w.time(e.timeStamp):Date.now(),{milli:Math.floor(o),micro:Number((o%1).toFixed(3))}),i={target:D(e.target),path:B(e),pageUrl:window.location.href,pageTitle:document.title,pageReferrer:document.referrer,browser:A(),clientTime:r.milli,microTime:r.micro,location:E(e),scrnRes:x(),type:e.type,logType:"raw",userAction:!0,details:t,userId:w.userId,toolVersion:w.version,toolName:w.toolName,useraleVersion:w.useraleVersion,sessionID:w.sessionID};return!("function"==typeof W&&!W(i))&&("function"==typeof k&&(i=k(i,e)),h.push(i),!0)}function I(e,n,t){if(!w.on)return!1;var o=null;n&&(o=n());var r={pageUrl:window.location.href,pageTitle:document.title,pageReferrer:document.referrer,browser:A(),clientTime:Date.now(),scrnRes:x(),logType:"custom",userAction:t,details:o,userId:w.userId,toolVersion:w.version,toolName:w.toolName,useraleVersion:w.useraleVersion,sessionID:w.sessionID},i=Object.assign(r,e);return!("function"==typeof W&&!W(i))&&("function"==typeof k&&(i=k(i)),h.push(i),!0)}function E(e){return null!=e.pageX?{x:e.pageX,y:e.pageY}:null!=e.clientX?{x:document.documentElement.scrollLeft+e.clientX,y:document.documentElement.scrollTop+e.clientY}:{x:null,y:null}}function x(){return{width:window.innerWidth,height:window.innerHeight}}function D(e){return e.localName?e.localName+(e.id?"#"+e.id:"")+(e.className?"."+e.className:""):e.nodeName?e.nodeName+(e.id?"#"+e.id:"")+(e.className?"."+e.className:""):e&&e.document&&e.location&&e.alert&&e.setInterval?"Window":"Unknown"}function B(e){var n=[];if(e.path)n=e.path;else for(var t=e.target;t;)n.push(t),t=t.parentElement;return function(e){var n,t=0,o=[];for(;n=e[t];)o.push(D(n)),++t;return o}(n)}function A(){return{browser:T?T.name:"",version:T?T.version:""}}var C,K,M,L=null;function V(e,n){null!==L&&clearInterval(L),L=function(e,n){return setInterval((function(){n.on&&e.length>=n.logCountThreshold&&(P(e.slice(0),n,0),e.splice(0))}),n.transmitInterval)}(e,n),function(e,n){if(!n.on)return;navigator.sendBeacon?window.addEventListener("unload",(function(){navigator.sendBeacon(n.url,JSON.stringify(e))})):window.addEventListener("beforeunload",(function(){e.length>0&&P(e,n,1)}))}(e,n)}function P(e,n,t){var o=new XMLHttpRequest,r=JSON.stringify(e);o.open("POST",n.url),n.authHeader&&o.setRequestHeader("Authorization",n.authHeader),o.setRequestHeader("Content-type","application/json;charset=UTF-8"),o.onreadystatechange=function(){4===o.readyState&&200!==o.status&&t>0&&P(e,n,t--)},o.send(r)}var R,X=["click","focus","blur","input","change","mouseover","submit"],_=["load","blur","focus"];function j(e){return{clicks:e.detail,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey}}function $(e){return function(e){C={click:j,dblclick:j,mousedown:j,mouseup:j,focus:null,blur:null,input:e.logDetails?function(e){return{value:e.target.value}}:null,change:e.logDetails?function(e){return{value:e.target.value}}:null,dragstart:null,dragend:null,drag:null,drop:null,keydown:e.logDetails?function(e){return{key:e.keyCode,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey}}:null,mouseover:null},K={},M={wheel:function(e){return{x:e.deltaX,y:e.deltaY,z:e.deltaZ}},scroll:function(){return{x:window.scrollX,y:window.scrollY}},resize:function(){return{width:window.outerWidth,height:window.outerHeight}}},R={submit:null}}(e),Object.keys(C).forEach((function(e){document.addEventListener(e,(function(n){N(n,C[e])}),!0)})),X.forEach((function(e){document.addEventListener(e,(function(e){!function(e){var n=D(e.target),t=B(e),o=e.type,r=Math.floor(e.timeStamp&&e.timeStamp>0?w.time(e.timeStamp):Date.now());if(null==g&&(g=n,v=o,y=t,b=r,S=0),g!==n||v!==o){if(O={target:g,path:y,pageUrl:window.location.href,pageTitle:document.title,pageReferrer:document.referrer,browser:A(),count:S,duration:r-b,startTime:b,endTime:r,type:v,logType:"interval",targetChange:g!==n,typeChange:v!==o,userAction:!1,userId:w.userId,toolVersion:w.version,toolName:w.toolName,useraleVersion:w.useraleVersion,sessionID:w.sessionID},"function"==typeof W&&!W(O))return!1;"function"==typeof k&&(O=k(O,e)),h.push(O),g=n,v=o,y=t,b=r,S=0}g==n&&v==o&&(S+=1)}(e)}),!0)})),Object.keys(M).forEach((function(n){K[n]=!0,window.addEventListener(n,(function(t){K[n]&&(K[n]=!1,N(t,M[n]),setTimeout((function(){K[n]=!0}),e.resolution))}),!0)})),Object.keys(R).forEach((function(n){document.addEventListener(n,(function(t){N(t,C[n]),function(e,n){n.on&&e.length>0&&P(e,n,1)}(h,e)}),!0)})),_.forEach((function(e){window.addEventListener(e,(function(e){N(e,(function(){return{window:!0}}))}),!0)})),!0}var H,Y={},F=[],z=Date.now();function J(n){e.started||setTimeout((function(){var t=document.readyState;"interactive"===t||"complete"===t?($(n),V(F,n),e.started=n.on=!0,I({type:"load",logType:"raw",pageLoadTime:H-z},(()=>{}),!1)):J(n)}),100)}window.onload=function(){H=Date.now()},e.started=!1,Y.on=!1,Y.useraleVersion=n,o(Y,function(){var e={};null===t&&(t=function(e,n){if(null===window.sessionStorage.getItem(e))return window.sessionStorage.setItem(e,JSON.stringify(n)),n;return JSON.parse(window.sessionStorage.getItem(e))}("userAleSessionId","session_"+String(Date.now())));var n,o=document.currentScript||(n=document.getElementsByTagName("script"))[n.length-1],r=o?o.getAttribute.bind(o):function(){return null};return e.autostart="false"!==r("data-autostart"),e.url=r("data-url")||"http://localhost:8000",e.transmitInterval=+r("data-interval")||5e3,e.logCountThreshold=+r("data-threshold")||5,e.userId=r("data-user")||null,e.version=r("data-version")||null,e.logDetails="true"===r("data-log-details"),e.resolution=+r("data-resolution")||500,e.toolName=r("data-tool")||null,e.userFromParams=r("data-user-from-params")||null,e.time=function(e){if(e.timeStamp&&e.timeStamp>0){var n,t=Date.now()-e.timeStamp;if(t<0)n=function(){return e.timeStamp/1e3};else if(t>e.timeStamp){var o=performance.timing.navigationStart;n=function(e){return e+o}}else n=function(e){return e}}else n=function(){return Date.now()};return n}(document.createEvent("CustomEvent")),e.sessionID=r("data-session")||t,e.authHeader=r("data-auth")||null,e.custIndex=r("data-index")||null,e}()),h=F,w=Y,W=null,k=null,g=null,v=null,y=null,b=null,S=0,O=null,Y.autostart&&J(Y);e.buildPath=B,e.details=function(e,n){return{click:j,dblclick:j,mousedown:j,mouseup:j,focus:null,blur:null,input:e.logDetails?function(e){return{value:e.target.value}}:null,change:e.logDetails?function(e){return{value:e.target.value}}:null,dragstart:null,dragend:null,drag:null,drop:null,keydown:e.logDetails?function(e){return{key:e.keyCode,ctrl:e.ctrlKey,alt:e.altKey,shift:e.shiftKey,meta:e.metaKey}}:null,mouseover:null,wheel:function(e){return{x:e.deltaX,y:e.deltaY,z:e.deltaZ}},scroll:function(){return{x:window.scrollX,y:window.scrollY}},resize:function(){return{width:window.outerWidth,height:window.outerHeight}},submit:null}[n]},e.filter=function(e){W=e},e.getSelector=D,e.log=function(e){return null!==e&&"object"==typeof e&&(F.push(e),!0)},e.map=function(e){k=e},e.options=function(e){return void 0!==e&&o(Y,e),Y},e.packageCustomLog=I,e.packageLog=N,e.start=function(){e.started||J(Y),Y.on=!0},e.stop=function(){Y.on=!1},e.version="2.1.1",Object.defineProperty(e,"__esModule",{value:!0})}));
